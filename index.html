<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II</title>
<style>
  body {
    font-family: Verdana, sans-serif;
    margin: 0;
    text-align: center;
    color: #002b5c;
    background: linear-gradient(180deg,#fff6e5 0%,#f3e0b8 100%);
    transition: background 0.6s;
  }
  body.teacher-mode {
    background: linear-gradient(180deg,#fff3b0 0%,#ffe27f 100%);
  }
  header {
    background: #003366;
    color: white;
    padding: 1rem;
    border-bottom: 5px solid gold;
    transition: background 0.6s;
  }
  body.teacher-mode header {
    background: gold;
    color: #003366;
  }
  #teacherBanner {
    display: none;
    background: gold;
    color: #003366;
    padding: 10px;
    font-weight: bold;
    border-bottom: 3px solid #003366;
  }
  body.teacher-mode #teacherBanner { display: block; }

  .btn {
    background:#003366;
    color:#fff;
    border:none;
    border-radius:10px;
    padding:10px 16px;
    font-weight:bold;
    cursor:pointer;
    margin:6px;
    transition:0.3s;
  }
  .btn:hover { background:gold; color:#003366; }

  .overlay {
    position:fixed;inset:0;
    background:rgba(0,0,0,0.55);
    display:flex;align-items:center;justify-content:center;
    z-index:999;
  }
  .overlay-card {
    background:white;
    border:4px solid gold;
    padding:20px;
    border-radius:16px;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    width:90%;max-width:380px;
  }
  .overlay-card input {
    width:100%;
    padding:8px;
    border-radius:8px;
    border:1px solid #ccc;
    margin:6px 0;
    font-size:1rem;
  }

  .grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:10px;
    max-width:900px;
    margin:20px auto;
  }
  .card {
    background:white;
    border:2px solid #dde6ff;
    border-radius:16px;
    padding:14px;
    cursor:pointer;
    box-shadow:0 0 10px rgba(0,0,0,0.05);
  }
  .card:hover { border-color:gold; transform:translateY(-2px); }

  #chatBox {
    background:white;
    border:2px solid gold;
    border-radius:10px;
    padding:10px;
    max-height:300px;
    overflow-y:auto;
    text-align:left;
  }

  #teacherWelcome {
    display:none;
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    background:gold;
    color:#003366;
    border:3px solid #003366;
    padding:10px 20px;
    border-radius:12px;
    font-weight:bold;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    animation:fadeInOut 4s ease forwards;
    z-index:1000;
  }
  @keyframes fadeInOut {
    0% {opacity:0; transform:translate(-50%, 20px);}
    15% {opacity:1; transform:translate(-50%, 0);}
    85% {opacity:1; transform:translate(-50%, 0);}
    100% {opacity:0; transform:translate(-50%, 20px);}
  }

  table { border-collapse:collapse; margin:auto; font-size:0.85rem; }
  th, td { border:1px solid #ccc; padding:5px 8px; }
  th { background:#003366; color:white; }
</style>
</head>
<body>

<div id="teacherBanner">ğŸ‘©â€ğŸ« TEACHER MODE ACTIVE</div>
<div id="teacherWelcome">Welcome, Teacher! ğŸ« Unlimited access activated.</div>

<!-- ğŸ” Login -->
<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h2>English with AI Bayan 4grade II</h2>
    <input type="text" id="nameInput" placeholder="Enter your name">
    <input type="password" id="pinInput" placeholder="Enter PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<header>
  <h1>English with AI Bayan 4grade II</h1>
</header>

<main>
  <div id="welcomeBox" style="display:none;">
    <h2 id="welcomeText"></h2>
    <p>You have <span id="totalStars">0</span> â­ total stars!</p>
  </div>

  <!-- Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ -->
  <div id="mainMenu" style="display:none;">
    <div class="grid">
      <div class="card" onclick="openTheme(1)">1. ğŸ¨ Letâ€™s Have Fun!</div>
      <div class="card" onclick="openTheme(2)">2. ğŸƒ Sports and Exercises</div>
      <div class="card" onclick="openTheme(3)">3. ğŸŒ Sports Around the World</div>
      <div class="card" onclick="openTheme(4)">4. ğŸµ Arts and Music</div>
      <div class="card" onclick="openTheme(5)">5. âš½ Popular Team Sports</div>
      <div class="card" onclick="openTheme(6)">6. ğŸ» Museum of Kazakh Musical Instruments</div>
      <div class="card" onclick="openTheme(7)">7. ğŸ“œ Childrenâ€™s Rights & Responsibilities</div>
      <div class="card" onclick="openTheme(8)">8. ğŸ§° Different Jobs</div>
      <div class="card" onclick="openTheme(9)">9. ğŸ‘©â€âš•ï¸ Professions</div>
      <div class="card" onclick="openTheme(10)">10. ğŸ¢ People at Work</div>
      <div class="card" onclick="openTheme(11)">11. ğŸ’¬ What Do You Do?</div>
      <div class="card" onclick="openTheme(12)">12. â¤ï¸ You Can Help!</div>
      <div class="card" onclick="openTheme(13)">13. ğŸ¯ Final Challenge</div>
      <div class="card" onclick="openChat()">ğŸ’¬ AI Bayan Chat</div>
      <div class="card" onclick="openTeacherJournal()">ğŸ« Teacher Journal</div>
    </div>
  </div>

  <!-- ğŸ’¬ AI Bayan Chat -->
  <div id="chatSection" style="display:none;">
    <h2>ğŸ’¬ AI Bayan Chat</h2>
    <div id="chatBox"></div>
    <textarea id="chatInput" placeholder="Type your question here..." 
              style="width:90%;border-radius:8px;margin-top:8px;min-height:60px;"></textarea><br>
    <button class="btn" onclick="askBayan()">Ask AI Bayan</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="backMenu()">ğŸ  Back to Menu</button>
    <p id="limitCounter" style="font-weight:bold;color:#003366;">â­ 3 of 3 questions left today</p>
  </div>

  <!-- ğŸ« Teacher Journal -->
  <div id="teacherJournal" style="display:none;">
    <h2>ğŸ« Teacher Journal</h2>
    <table>
      <thead>
        <tr>
          <th>Student</th>
          <th>L1â€“L13</th>
          <th>Chat</th>
          <th>Total â­</th>
        </tr>
      </thead>
      <tbody id="journalBody"></tbody>
    </table>
    <button class="btn" onclick="backMenu()">ğŸ  Back to Menu</button>
  </div>
</main>

<script>
const allowedNames=[
  "Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2","Ilyas2",
  "Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2","Kira2","Allahverdy2",
  "Aziza2","Emir2","Monya2","Aeka2","Bayan2","Arai2","Jury2","Jury1","Meyirim2"
];

function checkLogin(){
  const name=document.getElementById("nameInput").value.trim();
  const pin=document.getElementById("pinInput").value.trim();
  const lower=name.toLowerCase();
  const allowedLower=allowedNames.map(n=>n.toLowerCase());

  if(allowedLower.includes(lower)&&pin==="6856"){
    localStorage.setItem("currentStudent",name);
    localStorage.removeItem("isTeacher");
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
    document.getElementById("welcomeBox").style.display="block";
    document.getElementById("welcomeText").innerText="Hello, "+name+"!";
  } 
  else if(lower==="teacher"&&pin==="1402"){
    localStorage.setItem("isTeacher","true");
    isTeacher=true;
    document.body.classList.add("teacher-mode");
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("teacherBanner").style.display="block";
    document.getElementById("mainMenu").style.display="block";
    showTeacherWelcome();
    playDing();
  } 
  else alert("âŒ Wrong name or PIN");
}

function showTeacherWelcome(){
  const msg=document.getElementById("teacherWelcome");
  msg.style.display="block";
  setTimeout(()=>{msg.style.display="none";},4000);
}

// ğŸ”” Ğ·Ğ²ÑƒĞº
function playDing(){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.type="sine";
    o.frequency.value=880;
    g.gain.setValueAtTime(0.1,ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+1);
    o.connect(g);g.connect(ctx.destination);
    o.start();o.stop(ctx.currentTime+1);
  }catch(e){console.warn("Sound error:",e);}
}

function openTheme(n){window.location.href="theme"+n+".html";}

function openTeacherJournal(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("teacherJournal").style.display="block";
  buildJournal();
}

function buildJournal(){
  const body=document.getElementById("journalBody");
  body.innerHTML="";
  allowedNames.forEach(name=>{
    let total=0;
    for(let i=1;i<=13;i++) total += Number(localStorage.getItem(name+"_lesson"+i+"Stars"))||0;
    const chat=Number(localStorage.getItem(name+"_chatStars"))||0;
    total+=chat;
    body.innerHTML+=`<tr><td>${name}</td><td>${total-chat}</td><td>${chat}</td><td>${total}</td></tr>`;
  });
}

function backMenu(){
  document.getElementById("teacherJournal").style.display="none";
  document.getElementById("chatSection").style.display="none";
  document.getElementById("mainMenu").style.display="block";
}

let DAILY_LIMIT=3;
let usedToday=Number(localStorage.getItem("usedToday"))||0;
let lastDate=localStorage.getItem("lastDate");
const today=new Date().toDateString();
let isTeacher=localStorage.getItem("isTeacher")==="true";
if(lastDate!==today){usedToday=0;localStorage.setItem("lastDate",today);localStorage.setItem("usedToday",0);}

function updateCounter(){
  const c=document.getElementById("limitCounter");
  if(!c)return;
  c.innerHTML=isTeacher?"ğŸ‘©â€ğŸ« Teacher mode: unlimited questions":`â­ ${3-usedToday} of 3 questions left today`;
}

function openChat(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("chatSection").style.display="block";
  updateCounter();
}

function bayanSpeak(text){
  if(!('speechSynthesis'in window))return;
  const speakNow=()=>{
    const v=speechSynthesis.getVoices();
    let voice=v.find(x=>x.name.includes("Google UK English Female")||x.lang==="en-GB");
    if(!voice)voice=v[0];
    const u=new SpeechSynthesisUtterance(text);
    u.voice=voice;u.lang="en-GB";u.rate=0.9;u.pitch=1.1;u.volume=1;
    speechSynthesis.speak(u);
  };
  if(speechSynthesis.getVoices().length===0){
    speechSynthesis.onvoiceschanged=speakNow;
  } else speakNow();
}

async function askBayan(){
  const i=document.getElementById('chatInput');
  const b=document.getElementById('chatBox');
  const q=i.value.trim();
  if(!q){alert("Type your question first!");return;}
  if(!isTeacher&&usedToday>=3){alert("âš ï¸ Limit reached.");return;}
  b.innerHTML+=`<p><b>You:</b> ${q}</p>`;
  i.value="";
  b.innerHTML+=`<p><i>AI Bayan is thinking...</i></p>`;
  b.scrollTop=b.scrollHeight;
  try{
    const r=await fetch("https://shiny-tree-f78c.aiko030500.workers.dev",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({messages:[{role:"user",content:q}]})
    });
    const d=await r.json();
    const reply=d.reply||"Sorry, I canâ€™t answer now.";
    b.innerHTML+=`<p><b>AI Bayan:</b> ${reply}</p>`;
    bayanSpeak(reply);
    if(!isTeacher){usedToday++;localStorage.setItem("usedToday",usedToday);updateCounter();}
  }catch{b.innerHTML+=`<p><b>AI Bayan:</b> âŒ Connection error.</p>`;}
}
function clearChat(){document.getElementById("chatBox").innerHTML="";}
</script>
</body>
</html>
