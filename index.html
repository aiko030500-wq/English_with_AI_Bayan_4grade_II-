<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FF6F91">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="logo.png">

<style>
:root{
  --pink-bg:#FF6F91;
  --gold:#FFD54F;
  --gold-light:#FFF8C0;
}
*{box-sizing:border-box;}
body{
  font-family:Verdana,sans-serif;
  margin:0;
  text-align:center;
  background:var(--pink-bg);
  color:#fff;
}

/* HEADER */
header{
  background:linear-gradient(180deg,#FF7AA3 0%,#FF5C8D 100%);
  border-bottom:4px solid var(--gold);
  box-shadow:0 5px 15px rgba(0,0,0,0.4);
  padding-top:1rem;
  padding-bottom:0.6rem;
  position:relative;
}
h1{
  margin:0.4rem 0 0;
  font-size:1.7rem;
  color:var(--gold-light);
  text-shadow:0 0 10px rgba(255,255,255,0.4);
}
h2{
  margin:0;
  color:#fffbea;
  font-size:1rem;
}

/* ORNAMENT */
.ornament{width:100%;height:35px;margin-top:8px;}
svg path{
  fill:none;
  stroke:url(#goldGrad);
  stroke-width:2.5;
  stroke-linecap:round;
  filter:drop-shadow(0 0 5px rgba(255,255,180,0.6));
}

/* MAIN */
main{padding:1rem 0 4rem;}
.topics-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:10px;
  max-width:700px;
  margin:1rem auto;
}
.topic-btn{
  background:rgba(255,255,255,0.15);
  border:2px solid var(--gold);
  border-radius:14px;
  padding:10px 8px;
  font-size:0.95rem;
  font-weight:bold;
  color:var(--gold);
  text-shadow:0 0 6px rgba(255,255,100,0.5);
  cursor:pointer;
  box-shadow:0 3px 10px rgba(0,0,0,0.25);
  transition:0.25s;
}
.topic-btn:hover{
  background:var(--gold);
  color:#8B0035;
  text-shadow:none;
  transform:scale(1.03);
}

/* WELCOME */
#welcomeBox{
  background:rgba(255,255,255,0.15);
  border:2px solid var(--gold);
  border-radius:12px;
  max-width:700px;
  margin:15px auto;
  padding:10px;
  color:var(--gold);
  text-shadow:0 0 8px rgba(255,255,150,0.5);
}
#welcomeText{text-transform:capitalize;}

/* OVERLAY LOGIN */
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;align-items:center;justify-content:center;
  z-index:999;
}
.overlay-card{
  background:white;
  border:4px solid var(--gold);
  padding:20px;
  border-radius:16px;
  box-shadow:0 0 15px rgba(0,0,0,0.3);
  width:90%;max-width:380px;
  color:#8B0035;
}
.overlay-card input{
  width:100%;padding:8px;border-radius:8px;
  border:1px solid #ccc;margin:6px 0;font-size:1rem;
}
.btn{
  background:#8B0035;color:#fff;border:none;
  border-radius:10px;padding:8px 14px;font-weight:bold;
  cursor:pointer;margin:6px;font-size:0.9rem;
}
.btn:hover{background:var(--gold);color:#8B0035;}

/* CHAT & JOURNAL */
#chatSection,#teacherJournal{
  display:none;
  max-width:900px;
  margin:1rem auto;
  background:rgba(255,255,255,0.15);
  border:2px solid var(--gold);
  border-radius:12px;
  padding:10px;
}
#chatBox{
  background:white;border-radius:10px;
  padding:10px;max-height:300px;overflow-y:auto;
  text-align:left;color:#000;
}
textarea{width:90%;border-radius:8px;border:1px solid #ccc;padding:6px;min-height:60px;}

/* INSTALL BUTTON */
.install-btn{
  position:fixed;bottom:14px;left:50%;
  transform:translateX(-50%);
  background:var(--gold);color:#8B0035;
  border:none;border-radius:50%;
  width:64px;height:64px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-size:0.75rem;box-shadow:0 4px 10px rgba(0,0,0,0.4);cursor:pointer;
}
.install-btn .icon{font-size:1.3rem;margin-bottom:2px;}
.install-btn:hover{background:#fff59d;}
</style>
</head>

<body>
<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h2>English with AI Bayan</h2>
    <p>Enter your name and PIN:</p>
    <input type="text" id="nameInput" placeholder="Name">
    <input type="password" id="pinInput" placeholder="PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<header>
  <h1>ENGLISH WITH AI BAYAN</h1>
  <h2>4 GRADE II</h2>
  <div class="ornament">
    <svg viewBox="0 0 800 40" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
      <defs>
        <linearGradient id="goldGrad" x1="0" y1="0" x2="800" y2="0">
          <stop offset="0%" stop-color="#FFD700"/>
          <stop offset="50%" stop-color="#FFF8C0"/>
          <stop offset="100%" stop-color="#FFD700"/>
        </linearGradient>
      </defs>
      <path d="M0 20 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0"/>
    </svg>
  </div>
</header>

<main>
  <div id="mainMenu" style="display:none;">
    <div class="topics-grid">
      <button class="topic-btn" onclick="openTheme(1)">1. ğŸ¨ Letâ€™s Have Fun!</button>
      <button class="topic-btn" onclick="openTheme(2)">2. ğŸƒ Sports and Exercises</button>
      <button class="topic-btn" onclick="openTheme(3)">3. ğŸŒ Sports Around the World</button>
      <button class="topic-btn" onclick="openTheme(4)">4. ğŸµ Arts and Music</button>
      <button class="topic-btn" onclick="openTheme(5)">5. âš½ Popular Team Sports</button>
      <button class="topic-btn" onclick="openTheme(6)">6. ğŸ» Museum of Kazakh Musical Instruments</button>
      <button class="topic-btn" onclick="openTheme(7)">7. ğŸ“œ Childrenâ€™s Rights & Responsibilities</button>
      <button class="topic-btn" onclick="openTheme(8)">8. ğŸ§° Different Jobs</button>
      <button class="topic-btn" onclick="openTheme(9)">9. ğŸ‘©â€âš•ï¸ Professions</button>
      <button class="topic-btn" onclick="openTheme(10)">10. ğŸ¢ People at Work</button>
      <button class="topic-btn" onclick="openTheme(11)">11. ğŸ’¬ What Do You Do?</button>
      <button class="topic-btn" onclick="openTheme(12)">12. â¤ï¸ You Can Help!</button>
      <button class="topic-btn" onclick="openTheme(13)">13. ğŸ¯ Final Challenge</button>
      <button class="topic-btn" onclick="openChat()">ğŸ’¬ AI Bayan Chat</button>
      <button class="topic-btn" onclick="openTeacherJournal()">ğŸ« Teacherâ€™s Journal</button>
    </div>

    <div id="welcomeBox">
      <h3 id="welcomeText">Hello, Student!</h3>
      <p>Total stars in all lessons: <b><span id="totalStars">0</span> â­</b></p>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chatSection">
    <h2>ğŸ’¬ AI Bayan â€” Chat</h2>
    <div id="chatBox"></div>
    <textarea id="chatInput" placeholder="Type your question..."></textarea><br>
    <button class="btn" onclick="askBayan()">Ask</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="backMenu()">ğŸ  Menu</button>
    <p id="limitCounter" style="font-weight:bold;">â­ 3 of 3 questions left today</p>
  </div>

  <!-- JOURNAL -->
  <div id="teacherJournal">
    <h2>ğŸ« Teacher Journal</h2>
    <table style="width:100%;border-collapse:collapse;color:#fff;text-align:center;">
      <thead>
        <tr style="background:#8B0035;">
          <th>Student</th><th>L1â€“L13</th><th>Chat</th><th>Total â­</th>
        </tr>
      </thead>
      <tbody id="journalBody"></tbody>
    </table>
    <button class="btn" onclick="backMenu()">ğŸ  Menu</button>
  </div>
</main>

<button class="install-btn" id="installButton">
  <span class="icon">â¬‡ï¸</span>
  <span>Install</span>
</button>

<script>
const allowedNames=["Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2",
"Ilyas2","Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2","Kira2","Allahverdy2",
"Aziza2","Emir2","Monya2","Aeka2","Bayan2","Arai2","Jury2","Jury1","Meyirim2"];

const WORKER_URL="https://shiny-tree-f78c.aiko030500.workers.dev";
let DAILY_LIMIT=3;
let usedToday=Number(localStorage.getItem("usedToday"))||0;
let lastDate=localStorage.getItem("lastDate");
let today=new Date().toDateString();
let isTeacher=localStorage.getItem("isTeacher")==="true";
if(lastDate!==today){usedToday=0;localStorage.setItem("lastDate",today);localStorage.setItem("usedToday",0);}
function updateCounter(){
  const c=document.getElementById("limitCounter");
  if(!c)return;
  c.innerHTML=isTeacher?"ğŸ‘©â€ğŸ« Teacher mode: unlimited questions":`â­ ${DAILY_LIMIT-usedToday} of ${DAILY_LIMIT} left`;
}
function checkLogin(){
  const n=document.getElementById("nameInput").value.trim().toLowerCase();
  const p=document.getElementById("pinInput").value.trim();
  const a=allowedNames.map(x=>x.toLowerCase());
  if(a.includes(n)&&p==="6856"){
    localStorage.setItem("currentStudent",n);
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
  }else if(n==="teacher"&&p==="1402"){
    isTeacher=true;localStorage.setItem("isTeacher","true");
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
  }else alert("âŒ Wrong name or PIN");
}
function openTheme(n){window.location.href="theme"+n+".html";}
function openChat(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("chatSection").style.display="block";
  updateCounter();
}
function openTeacherJournal(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("teacherJournal").style.display="block";
  buildJournal();
}
function backMenu(){
  document.getElementById("chatSection").style.display="none";
  document.getElementById("teacherJournal").style.display="none";
  document.getElementById("mainMenu").style.display="block";
}
function buildJournal(){
  const b=document.getElementById("journalBody");b.innerHTML="";
  allowedNames.forEach(n=>{
    let lessons=0;
    for(let i=1;i<=13;i++){lessons+=Number(localStorage.getItem(n+"_lesson"+i+"Stars"))||0;}
    const chatStars=Number(localStorage.getItem(n+"_chatStars"))||0;
    const total=lessons+chatStars;
    b.innerHTML+=`<tr><td>${n}</td><td>${lessons}</td><td>${chatStars}</td><td>${total}</td></tr>`;
  });
}
async function askBayan(){
  const input=document.getElementById("chatInput");
  const box=document.getElementById("chatBox");
  const q=input.value.trim();if(!q)return alert("Type your question!");
  if(!isTeacher&&usedToday>=DAILY_LIMIT){alert("âš ï¸ Daily limit reached.");return;}
  box.innerHTML+=`<p><b>You:</b> ${q}</p><p><i>AI Bayan is thinking...</i></p>`;box.scrollTop=box.scrollHeight;
  try{
    const r=await fetch(WORKER_URL,{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({messages:[{role:"user",content:q}]})});
    const d=await r.json();
    const reply=d.reply||"Sorry, I canâ€™t answer now.";
    box.innerHTML+=`<p><b>AI Bayan:</b> ${reply}</p>`;
    if(!isTeacher){usedToday++;localStorage.setItem("usedToday",usedToday);updateCounter();}
  }catch(e){box.innerHTML+=`<p><b>AI Bayan:</b> âŒ Connection error.</p>`;}
}
function clearChat(){document.getElementById("chatBox").innerHTML="";}
updateCounter();
</script>
</body>
</html>
