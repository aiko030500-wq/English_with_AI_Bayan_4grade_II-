<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FFC8A2">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="logo.png">

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:Verdana,sans-serif;
  background:#FFF9F2; /* –∫—Ä–µ–º–æ–≤–æ-–º–æ–ª–æ—á–Ω—ã–π —Ñ–æ–Ω */
  text-align:center;
  color:#000;
}

/* HEADER ‚Äì –Ω–µ–∂–Ω—ã–π —Ä–æ–∑–æ–≤–æ-–ø–µ—Ä—Å–∏–∫–æ–≤—ã–π + –∑–æ–ª–æ—Ç–æ–π –æ—Ä–Ω–∞–º–µ–Ω—Ç */
header{
  background:linear-gradient(180deg,#FFD6D9 0%,#FFC8A2 100%);
  border-bottom:4px solid #FFD54F;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
  padding:10px 6px 0;
}
header h1{
  margin:4px 0 0;
  font-size:1.6rem;
  font-weight:bold;
  color:#4A2C2C;
  text-shadow:0 0 8px rgba(255,255,255,0.6);
}
header h2{
  margin:0 0 4px;
  font-size:1rem;
  color:#5C3B3B;
}
.ornament{
  width:100%;
  height:30px;
}
.ornament svg path{
  fill:none;
  stroke:url(#goldGrad);
  stroke-width:2.5;
  stroke-linecap:round;
  filter:drop-shadow(0 0 4px rgba(255,255,180,0.7));
}

/* LOGIN OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.overlay-card{
  background:#fff;
  border:4px solid #CBAE7C;
  padding:20px;
  border-radius:16px;
  box-shadow:0 0 15px rgba(0,0,0,0.35);
  width:90%;
  max-width:380px;
  color:#5B4A33;
}
.overlay-card h2{margin-top:0;margin-bottom:6px;}
.overlay-card p{margin:0 0 8px;}
.overlay-card input{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin:6px 0;
  font-size:1rem;
}
.btn{
  background:#5B4A33;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 14px;
  font-weight:bold;
  cursor:pointer;
  margin:6px;
  font-size:0.9rem;
}
.btn:hover{
  background:#CBAE7C;
  color:#000;
}

/* MAIN */
main{
  padding:12px 8px 90px;
}

/* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
#mainMenu{display:none;}
.topics-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:8px;
  max-width:680px;
  margin:14px auto 10px;
}

/* –ö–Ω–æ–ø–∫–∏ —Ç–µ–º ‚Äì —è—Ä–∫–∏–µ, –Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ */
.topic-btn{
  border:none;
  border-radius:10px;
  padding:9px 6px;
  font-size:0.9rem;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,0.22);
  transition:0.2s transform,0.2s box-shadow,0.2s filter;
  line-height:1.25;
}
.topic-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  filter:brightness(1.05);
}

/* –¶–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ (—è—Ä—á–µ, –Ω–æ –≤ –ª–æ–≥–∏–∫–µ —Ç–≤–æ–∏—Ö —Ç–µ–º) */
.t1{ background:#8C5BDE; }   /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π ‚Äì Let‚Äôs Have Fun */
.t2{ background:#B86A33; }   /* —Ç—ë–ø–ª—ã–π –∫–æ—Ä–∏—á–Ω–µ–≤–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äì Sports & Exercises */
.t3{ background:#1A9A5E; }   /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –∑–µ–ª—ë–Ω—ã–π ‚Äì Sports Around the World */
.t4{ background:#E67829; }   /* –æ—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äì Arts and Music */
.t5{ background:#1889B6; }   /* —è—Ä–∫–∏–π –±–∏—Ä—é–∑–æ–≤–æ-—Å–∏–Ω–∏–π ‚Äì Popular Team Sports */
.t6{ background:#7A5334; }   /* –≥–ª—É–±–æ–∫–∏–π –∫–æ—Ñ–µ–π–Ω—ã–π ‚Äì Kazakh Instruments */
.t7{ background:#2F63C9; }   /* –≤–∞—Å–∏–ª—å–∫–æ–≤—ã–π —Å–∏–Ω–∏–π ‚Äì Children‚Äôs Rights */
.t8{ background:#F08A1F; }   /* –æ—Ä–∞–Ω–∂–µ–≤–æ-–º–µ–¥–æ–≤—ã–π ‚Äì Different Jobs */
.t9{ background:#B73655; }   /* –º–∞–ª–∏–Ω–æ–≤–æ-–±–æ—Ä–¥–æ–≤—ã–π ‚Äì Professions */
.t10{ background:#D95C8D; }  /* —è—Ä–∫–æ-—Ä–æ–∑–æ–≤—ã–π ‚Äì People at Work */
.t11{ background:#D63232; }  /* –∫—Ä–∞—Å–Ω—ã–π ‚Äì What Do You Do? */
.t12{ background:#2F9A4C; }  /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –∑–µ–ª—ë–Ω—ã–π ‚Äì You Can Help */
.t13{ background:#6B3ACF; }  /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π ‚Äì Final Challenge */

/* –ö–Ω–æ–ø–∫–∏ –ß–ê–¢ / –ñ–£–†–ù–ê–õ */
#extraBtns{
  margin-top:10px;
  display:flex;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
}
.extra-btn{
  background:#DCC7A1;
  border:none;
  border-radius:10px;
  padding:8px 16px;
  font-weight:bold;
  color:#3C2F1E;
  cursor:pointer;
  box-shadow:0 3px 6px rgba(0,0,0,0.18);
  transition:0.2s;
}
.extra-btn:hover{background:#EBDAB5;}

/* –ü–†–ò–í–ï–¢–°–¢–í–ò–ï */
#welcomeBox{
  margin:16px auto 0;
  background:#F2E4CC;
  border:2px solid #C5AF84;
  border-radius:10px;
  max-width:680px;
  padding:8px;
  color:#3C2F1E;
  font-weight:bold;
}
#welcomeText{
  margin-bottom:4px;
  text-transform:capitalize;
}

/* CHAT & JOURNAL */
#chatSection,#teacherJournal{
  display:none;
  max-width:900px;
  margin:12px auto;
  background:#F3E9CF;
  border:2px solid #CBAE7C;
  border-radius:12px;
  padding:10px;
}
#chatSection h2,#teacherJournal h2{
  margin-bottom:8px;
  color:#5B4A33;
}
#chatBox{
  background:#fff;
  border-radius:8px;
  padding:8px;
  max-height:260px;
  overflow-y:auto;
  text-align:left;
  color:#000;
  border:1px solid #ddd;
}
textarea{
  width:95%;
  border-radius:8px;
  border:1px solid #ccc;
  padding:6px;
  font-family:inherit;
  min-height:60px;
  margin-top:6px;
}
#limitCounter{
  margin-top:4px;
  font-size:0.9rem;
  color:#5B4A33;
  font-weight:bold;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:0.85rem;
}
th,td{
  border:1px solid #CBAE7C;
  padding:4px 6px;
}
th{
  background:#5B4A33;
  color:#fff;
}

/* INSTALL */
.install-btn{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  background:#C5AF84;
  color:#fff;
  border:none;
  border-radius:50%;
  width:50px;
  height:50px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:0.8rem;
  box-shadow:0 3px 8px rgba(0,0,0,0.35);
  cursor:pointer;
  z-index:50;
}
.install-btn:hover{background:#E8D2A4;}

@media (max-width:700px){
  .topics-grid{max-width:95%;}
  header h1{font-size:1.4rem;}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h2>English with AI Bayan</h2>
    <p>Enter your name and PIN:</p>
    <input type="text" id="nameInput" placeholder="Name">
    <input type="password" id="pinInput" placeholder="PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<!-- HEADER -->
<header>
  <h1>ENGLISH WITH AI BAYAN</h1>
  <h2>4 GRADE II</h2>
  <div class="ornament">
    <svg viewBox="0 0 800 40" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
      <defs>
        <linearGradient id="goldGrad" x1="0" y1="0" x2="800" y2="0">
          <stop offset="0%" stop-color="#FFD700"/>
          <stop offset="50%" stop-color="#FFF8C0"/>
          <stop offset="100%" stop-color="#FFD700"/>
        </linearGradient>
      </defs>
      <path d="M0 20 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0 q20 -18 40 0 t40 0"/>
    </svg>
  </div>
</header>

<main>
  <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
  <div id="mainMenu">
    <div class="topics-grid">
      <button class="topic-btn t1" onclick="openTheme(1)">1. üé® Let‚Äôs Have Fun!</button>
      <button class="topic-btn t2" onclick="openTheme(2)">2. üèÉ Sports and Exercises</button>
      <button class="topic-btn t3" onclick="openTheme(3)">3. üåç Sports Around the World</button>
      <button class="topic-btn t4" onclick="openTheme(4)">4. üéµ Arts and Music</button>
      <button class="topic-btn t5" onclick="openTheme(5)">5. ‚öΩ Popular Team Sports</button>
      <button class="topic-btn t6" onclick="openTheme(6)">6. üéª Museum of Kazakh Musical Instruments</button>
      <button class="topic-btn t7" onclick="openTheme(7)">7. üìú Children‚Äôs Rights & Responsibilities</button>
      <button class="topic-btn t8" onclick="openTheme(8)">8. üß∞ Different Jobs</button>
      <button class="topic-btn t9" onclick="openTheme(9)">9. üë©‚Äç‚öïÔ∏è Professions</button>
      <button class="topic-btn t10" onclick="openTheme(10)">10. üè¢ People at Work</button>
      <button class="topic-btn t11" onclick="openTheme(11)">11. üí¨ What Do You Do?</button>
      <button class="topic-btn t12" onclick="openTheme(12)">12. ‚ù§Ô∏è You Can Help!</button>
      <button class="topic-btn t13" onclick="openTheme(13)">13. üéØ Final Challenge</button>
    </div>

    <div id="extraBtns">
      <button class="extra-btn" onclick="openChat()">üí¨ AI Bayan Chat</button>
      <button class="extra-btn" onclick="openTeacherJournal()">üè´ Teacher‚Äôs Journal</button>
    </div>

    <div id="welcomeBox">
      <div id="welcomeText">Hello, Student!</div>
      <div>Total stars in all lessons: <b><span id="totalStars">0</span> ‚≠ê</b></div>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chatSection">
    <h2>üí¨ AI Bayan ‚Äî Chat</h2>
    <div id="chatBox"></div>
    <textarea id="chatInput" placeholder="Type your question..."></textarea><br>
    <button class="btn" onclick="askBayan()">Ask</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="backMenu()">üè† Menu</button>
    <p id="limitCounter">‚≠ê 3 of 3 questions left today</p>
  </div>

  <!-- JOURNAL -->
  <div id="teacherJournal">
    <h2>üè´ Teacher Journal</h2>
    <table>
      <thead>
        <tr>
          <th>Student</th><th>L1‚ÄìL13</th><th>Chat</th><th>Total ‚≠ê</th>
        </tr>
      </thead>
      <tbody id="journalBody"></tbody>
    </table>
    <button class="btn" onclick="backMenu()">üè† Menu</button>
  </div>
</main>

<!-- INSTALL -->
<button class="install-btn" id="installButton">‚¨áÔ∏è</button>

<script>
const allowedNames=[
  "Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2",
  "Ilyas2","Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2",
  "Kira2","Allahverdy2","Aziza2","Emir2","Monya2","Aeka2",
  "Bayan2","Arai2","Jury2","Jury1","Meyirim2"
];
const WORKER_URL="https://shiny-tree-f78c.aiko030500.workers.dev";

let DAILY_LIMIT=3;
let usedToday=Number(localStorage.getItem("usedToday"))||0;
let lastDate=localStorage.getItem("lastDate");
let today=new Date().toDateString();
let isTeacher=localStorage.getItem("isTeacher")==="true";

if(lastDate!==today){
  usedToday=0;
  localStorage.setItem("lastDate",today);
  localStorage.setItem("usedToday",0);
}

function updateCounter(){
  const c=document.getElementById("limitCounter");
  if(!c) return;
  c.innerHTML = isTeacher
    ? "üë©‚Äçüè´ Teacher mode: unlimited questions"
    : `‚≠ê ${DAILY_LIMIT-usedToday} of ${DAILY_LIMIT} questions left today`;
}

/* LOGIN */
function checkLogin(){
  const n=document.getElementById("nameInput").value.trim().toLowerCase();
  const p=document.getElementById("pinInput").value.trim();
  const a=allowedNames.map(x=>x.toLowerCase());

  if(a.includes(n) && p==="6856"){
    localStorage.setItem("currentStudent",n);
    localStorage.removeItem("isTeacher");
    isTeacher=false;
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
    const niceName=n.charAt(0).toUpperCase()+n.slice(1);
    document.getElementById("welcomeText").innerText="Hello, "+niceName+"!";
    calcTotalStars(n);
    updateCounter();
  } else if(n==="teacher" && p==="1402"){
    isTeacher=true;
    localStorage.setItem("isTeacher","true");
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
    document.getElementById("welcomeText").innerText="Hello, Teacher!";
    calcTotalStarsForAll();
    updateCounter();
  } else {
    alert("‚ùå Wrong name or PIN");
  }
}

/* STARS */
function calcTotalStars(studentKey){
  let total=0;
  for(let i=1;i<=13;i++){
    total+=Number(localStorage.getItem(studentKey+"_lesson"+i+"Stars"))||0;
  }
  total+=Number(localStorage.getItem(studentKey+"_chatStars"))||0;
  document.getElementById("totalStars").innerText=total;
}
function calcTotalStarsForAll(){
  let total=0;
  allowedNames.forEach(n=>{
    for(let i=1;i<=13;i++){
      total+=Number(localStorage.getItem(n+"_lesson"+i+"Stars"))||0;
    }
    total+=Number(localStorage.getItem(n+"_chatStars"))||0;
  });
  document.getElementById("totalStars").innerText=total;
}

/* NAVIGATION */
function openTheme(n){
  window.location.href="theme"+n+".html";
}
function openChat(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("chatSection").style.display="block";
  document.getElementById("teacherJournal").style.display="none";
  updateCounter();
}
function openTeacherJournal(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("chatSection").style.display="none";
  document.getElementById("teacherJournal").style.display="block";
  buildJournal();
}
function backMenu(){
  document.getElementById("chatSection").style.display="none";
  document.getElementById("teacherJournal").style.display="none";
  document.getElementById("mainMenu").style.display="block";
}

/* JOURNAL */
function buildJournal(){
  const b=document.getElementById("journalBody");
  b.innerHTML="";
  allowedNames.forEach(n=>{
    let lessonsStars=0;
    for(let i=1;i<=13;i++){
      lessonsStars+=Number(localStorage.getItem(n+"_lesson"+i+"Stars"))||0;
    }
    const chatStars=Number(localStorage.getItem(n+"_chatStars"))||0;
    const total=lessonsStars+chatStars;
    b.innerHTML+=`<tr>
      <td>${n}</td>
      <td>${lessonsStars}</td>
      <td>${chatStars}</td>
      <td>${total}</td>
    </tr>`;
  });
}

/* CHAT */
async function askBayan(){
  const input=document.getElementById("chatInput");
  const box=document.getElementById("chatBox");
  const q=input.value.trim();
  if(!q){
    alert("Type your question first!");
    return;
  }
  if(!isTeacher && usedToday>=DAILY_LIMIT){
    alert("‚ö†Ô∏è Daily limit reached.");
    return;
  }
  box.innerHTML+=`<p><b>You:</b> ${q}</p>`;
  box.innerHTML+=`<p><i>AI Bayan is thinking...</i></p>`;
  box.scrollTop=box.scrollHeight;
  input.value="";

  try{
    const r=await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({messages:[{role:"user",content:q}]})
    });
    const d=await r.json();
    const reply=d.reply || "Sorry, I can‚Äôt answer now.";
    box.innerHTML+=`<p><b>AI Bayan:</b> ${reply}</p>`;
    box.scrollTop=box.scrollHeight;

    if(!isTeacher){
      usedToday++;
      localStorage.setItem("usedToday",usedToday);
      updateCounter();
    }
  }catch(e){
    box.innerHTML+=`<p><b>AI Bayan:</b> ‚ùå Connection error.</p>`;
  }
}
function clearChat(){
  document.getElementById("chatBox").innerHTML="";
}

/* INSTALL PWA */
let deferredPrompt=null;
window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();
  deferredPrompt=e;
});
document.getElementById("installButton").addEventListener("click",async ()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt=null;
  }else{
    alert('To install the app, open the browser menu and choose "Add to Home screen".');
  }
});

updateCounter();
</script>

</body>
</html>
