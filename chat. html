<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Bayan Chat ‚Äî English with AI Bayan 4grade II</title>
<style>
  body{
    font-family:Verdana,sans-serif;
    background:linear-gradient(180deg,#fff6e5 0%,#f3e0b8 100%);
    margin:0;color:#002b5c;text-align:center;
  }
  header{background:#003366;color:white;padding:1rem;border-bottom:5px solid gold;}
  #chatBox{
    max-width:700px;margin:0 auto;background:white;border:2px solid gold;
    border-radius:12px;padding:10px;height:360px;overflow-y:auto;text-align:left;
    font-size:0.95rem;
  }
  .msg{margin:6px 0;padding:6px 10px;border-radius:10px;line-height:1.4;}
  .user{background:#e3f2fd;border-left:3px solid #1565c0;}
  .ai{background:#fff8e1;border-left:3px solid gold;}
  textarea{
    width:95%;max-width:700px;margin-top:10px;min-height:60px;border-radius:10px;
    border:1px solid #ccc;font-family:inherit;font-size:1rem;padding:6px;
  }
  .btn{
    display:inline-block;margin:6px;padding:8px 14px;border-radius:10px;
    border:none;background:#003366;color:white;font-weight:bold;cursor:pointer;
  }
  .btn:hover{background:gold;color:#003366;}
  .pulse{display:inline-block;width:12px;height:12px;margin-right:6px;
    border-radius:50%;background:red;animation:pulse 1s infinite;vertical-align:middle;}
  @keyframes pulse{
    0%{opacity:1;transform:scale(1);}
    50%{opacity:0.3;transform:scale(1.3);}
    100%{opacity:1;transform:scale(1);}
  }
</style>
</head>
<body>

<header>
  <h1>üí¨ AI Bayan ‚Äî Online + Offline Auto</h1>
  <p style="font-size:0.9rem;margin:0;">English with AI Bayan 4grade II</p>
</header>

<main>
  <div id="chatBox"></div>
  <textarea id="chatInput" placeholder="Type your question here..."></textarea><br>
  <button class="btn" onclick="askBayan()">Ask AI Bayan</button>
  <button class="btn" onclick="clearChat()">Clear</button>
  <button class="btn" onclick="startSpeech()">üéôÔ∏è Speak</button>
  <p id="micStatus" style="font-size:0.85rem;color:#555;"></p>
</main>

<script>
/* === ONLINE + AUTO-OFFLINE === */
async function askBayan(){
  const input=document.getElementById('chatInput');
  const box=document.getElementById('chatBox');
  const question=input.value.trim();
  if(!question){alert("Type your question first.");return;}
  addMsg("user",question);
  addMsg("ai","<i>AI Bayan is thinking...</i>",true);

  try{
    const controller=new AbortController();
    const timeoutId=setTimeout(()=>controller.abort(),5000);
    const response=await fetch("https://shiny-tree-f78c.aiko030500.workers.dev",{
      method:"POST",headers:{"Content-Type":"application/json"},signal:controller.signal,
      body:JSON.stringify({
        model:"gpt-4o-mini",
        messages:[
          {role:"system",content:"You are AI Bayan, a kind English teacher for 4th grade kids in Kazakhstan."},
          {role:"user",content:question}
        ]
      })
